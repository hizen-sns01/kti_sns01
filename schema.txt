-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.chatroom_ad (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  chatroom_id uuid NOT NULL,
  user_id uuid NOT NULL,
  role text NOT NULL DEFAULT 'RA'::text,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT chatroom_ad_pkey PRIMARY KEY (id),
  CONSTRAINT chatroom_ad_chatroom_id_fkey FOREIGN KEY (chatroom_id) REFERENCES public.chatrooms(id),
  CONSTRAINT chatroom_ad_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.chatrooms (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  interest text UNIQUE,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  last_message_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  idle_threshold_minutes integer,
  news_share_interval_minutes integer,
  last_news_share_at timestamp with time zone,
  persona text,
  is_activate boolean,
  enable_article_summary boolean DEFAULT false,
  CONSTRAINT chatrooms_pkey PRIMARY KEY (id)
);
CREATE TABLE public.feeds (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  chatroom_id uuid,
  title text NOT NULL,
  content text NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT feeds_pkey PRIMARY KEY (id),
  CONSTRAINT feeds_chatroom_id_fkey FOREIGN KEY (chatroom_id) REFERENCES public.chatrooms(id)
);
CREATE TABLE public.message_comments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  message_id bigint,
  user_id uuid,
  content text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT message_comments_pkey PRIMARY KEY (id),
  CONSTRAINT message_comments_message_id_fkey FOREIGN KEY (message_id) REFERENCES public.messages(id),
  CONSTRAINT message_comments_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.message_dislikes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  message_id bigint,
  user_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT message_dislikes_pkey PRIMARY KEY (id),
  CONSTRAINT message_dislikes_message_id_fkey FOREIGN KEY (message_id) REFERENCES public.messages(id),
  CONSTRAINT message_dislikes_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.message_likes (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  message_id bigint NOT NULL,
  user_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT message_likes_pkey PRIMARY KEY (id),
  CONSTRAINT message_likes_message_id_fkey FOREIGN KEY (message_id) REFERENCES public.messages(id),
  CONSTRAINT message_likes_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.messages (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  chatroom_id uuid NOT NULL,
  user_id uuid NOT NULL,
  content text NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  is_ai_curator boolean NOT NULL DEFAULT false,
  curator_message_type text,
  CONSTRAINT messages_pkey PRIMARY KEY (id),
  CONSTRAINT messages_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT fk_user_id FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.participants (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  chatroom_id uuid NOT NULL,
  user_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  last_read_at timestamp with time zone,
  CONSTRAINT participants_pkey PRIMARY KEY (id),
  CONSTRAINT participants_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.post_comments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id uuid,
  user_id uuid,
  content text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT post_comments_pkey PRIMARY KEY (id),
  CONSTRAINT post_comments_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.feeds(id),
  CONSTRAINT post_comments_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.post_dislikes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id uuid,
  user_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT post_dislikes_pkey PRIMARY KEY (id),
  CONSTRAINT post_dislikes_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.feeds(id),
  CONSTRAINT post_dislikes_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.post_likes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id uuid,
  user_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT post_likes_pkey PRIMARY KEY (id),
  CONSTRAINT post_likes_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.feeds(id),
  CONSTRAINT post_likes_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.prescriptions (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  user_id uuid NOT NULL,
  content text,
  image_url text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT prescriptions_pkey PRIMARY KEY (id),
  CONSTRAINT prescriptions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  nickname text UNIQUE,
  interests ARRAY,
  email text,
  is_ai_curator boolean DEFAULT false,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);
CREATE TABLE public.user_activity_metrics (
  user_id uuid NOT NULL,
  total_activity_time_minutes bigint DEFAULT 0,
  total_messages integer DEFAULT 0,
  total_reactions_received integer DEFAULT 0,
  total_shares integer DEFAULT 0,
  rooms_created integer DEFAULT 0,
  participants_in_rooms integer DEFAULT 0,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_activity_metrics_pkey PRIMARY KEY (user_id),
  CONSTRAINT user_activity_metrics_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);